/*! JSTABLE - v0.1.0 - 2013-03-06
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 YOUR_NAME; Licensed MIT */
var PJ=PJ||{};PJ.Class=function(e){var t=function(e){for(var t in e)this[t]=e[t];this.init.apply(this,arguments)};return t.prototype.init=function(){},t.fn=t.prototype,t.fn.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},t.sub=function(e){},t.sub=function(e){var t={};for(var n in this.fn)t[n]=this.fn[n];for(var n in e)t[n]=e[n];return new PJ.Class(t)},t.include=function(e){typeof e=="function"&&(e=e());for(var n in e)t.fn[n]=e[n]},e&&t.include(e),t},PJ.Events=function(){return{listeners:{},trigger:function(e,t){this.getHandlers(e).forEach(function(e){e(t)})},bind:function(e,t){this.getHandlers(e).push(t)},getHandlers:function(e){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e]}}},PJ.DataSource=new PJ.Class({initialize:function(){}}),PJ.ArrayDataSource=PJ.DataSource.sub({data:[],init:function(e){e&&(this.data=e)},size:function(){return this.data.length},get:function(e){if(e.from>this.data.length)return[];if(!e.size)return this.data;var t=e.from,n=e.from+e.size;return n>this.data.length&&(n=this.data.length),this.data.slice(t,n)}}),PJ.PaginationView=new PJ.Class({render:function(e){},selectPage:function(e){}}),PJ.PaginationView.include(PJ.Events),PJ.NoPaginationView=PJ.PaginationView.sub({}),PJ.JQueryTemplatePaginationView=PJ.PaginationView.sub({paginationBarTemplate:'<div>{{each(idx,p) pages}} <a class="pagination-page" href="#" data-page="${idx+1}">[${idx+1}</a>] {{/each}}</div>',target:null,render:function(e){$(this.paginationBarTemplate).tmpl({pages:new Array(e.pages)}).appendTo(this.target),this.target.find(".pagination-page").on("click",this.proxy(function(e){var t=parseInt($(e.currentTarget).attr("data-page"));this.trigger("page-requested",{pageNumber:t})})),this.target.find(".pgn-prev").on("click",this.proxy(function(e){this.trigger("page-step",-1)})),this.target.find(".pgn-next").on("click",this.proxy(function(e){this.trigger("page-step",1)})),this.selectPage(e.currentPage)}}),PJ.PaginationStrategy=new PJ.Class({pageSize:20,currentPage:1,view:new PJ.NoPaginationView,initialize:function(e){this.maxPage=Math.ceil(e.size()/this.pageSize),this.view.render({pageSize:this.pageSize,dataSetSize:e.size(),pages:this.maxPage,currentPage:1})}}),PJ.PaginationStrategy.include(PJ.Events),PJ.NoPagination=PJ.PaginationStrategy.sub({maxResults:50,getPageQuery:function(){return{from:0}}}),PJ.PaginationBar=PJ.PaginationStrategy.sub({init:function(){this.view.bind("page-requested",this.proxy(function(e){this.selectPage(e.pageNumber)})),this.view.bind("page-step",this.proxy(function(e){this.selectPage(this.currentPage+e)}))},selectPage:function(e){if(e<=0||e>this.maxPage)return;this.currentPage=e,this.trigger("pagination-changed"),this.view.selectPage(this.currentPage)},getPageQuery:function(){return{from:(this.currentPage-1)*this.pageSize,size:this.pageSize}}}),PJ.BasicColumnModel=new PJ.Class({showActions:function(){return this.actions!=null&&this.actions.length>0}}),PJ.TableView=new PJ.Class({init:function(){console.log("init TableView")},initialize:function(e){this.render({columnModel:e,data:[]})},render:function(e){},updateRows:function(e){}}),PJ.JQueryTemplateView=PJ.TableView.sub({target:null,tableTemplate:'<table><tr class="header-row"></tr></table>',noContentRow:'<tr class="no-content-row"><td>No content</td></tr>',headerTemplate:"<th>${header}</th>",rowTemplate:'{{each(i,row) data}}    <tr class="data-row">      {{each(idx,col) columnModel.columns}}        <td>${row[col.index]}</td>      {{/each}}      {{if columnModel.showActions()}}        <td>          {{html layoutActions(columnModel, row)}}        </td>      {{/if}}    </tr>  {{/each}}',actionsTemplate:"{{each(idx,action) columnModel.actions}}      {{html actionFormatter(action)}}    {{/each}}",actionTemplate:'<a href="#" class="action-link" data-action-id="${action.id}">${action.label}</a>',layoutActions:function(e,t){var n=$("<span></span>");return $(this.wrap(this.actionsTemplate)).tmpl({columnModel:e,row:t,actionFormatter:this.proxy(this.actionFormatter)}).appendTo(n),n.html()},actionFormatter:function(e){var t=$("<span></span>");return $(this.wrap(this.actionTemplate)).tmpl({action:e}).appendTo(t),t.html()},init:function(){},render:function(e){$(this.wrap(this.tableTemplate)).tmpl().appendTo(this.target),$(this.wrap(this.headerTemplate)).tmpl(e.columnModel.columns).appendTo(this.target.find(".header-row")),e.data&&this.updateRows(e),this.target.on("click",".action-link",this.proxy(function(e){e.preventDefault();var t=$(e.currentTarget);return this.trigger("action-requested",{action:t.attr("data-action-id"),row:this.currentDataSet[t.closest("tr").index()-1]}),!1}))},updateRows:function(e){this.currentDataSet=e.data,e.data.length==0?$(this.wrap(this.noContentRow)).tmpl().appendTo(this.target.find("table tbody")):(this.target.find(".no-content-row").remove(),this.target.find(".data-row").remove(),$(this.wrap(this.rowTemplate)).tmpl($.extend({layoutActions:this.proxy(this.layoutActions)},e)).appendTo(this.target.find("table tbody")))},wrap:function(e){return"<script>"+e+"</script>"}}),PJ.JQueryTemplateView.include(PJ.Events),PJ.Table=new PJ.Class({view:null,dataSource:null,columnModel:null,paginationStrategy:new PJ.NoPagination,init:function(){this.initialize()},initialize:function(){this.initializeDataSource(),this.initializeView(),this.initializePagination(),this.paginationStrategy.bind("pagination-changed",this.proxy(this.refreshTable))},refreshTable:function(){this.view.updateRows({data:this.dataSource.get(this.paginationStrategy.getPageQuery()),columnModel:this.columnModel})},initializeView:function(){if(!this.view)throw new Error("No view specified.");this.view.initialize(this.columnModel),this.refreshTable()},initializeDataSource:function(){this.dataSource||(this.dataSource=new PJ.ArrayDataSource({data:[]})),this.dataSource.initialize()},initializePagination:function(){this.paginationStrategy.initialize(this.dataSource)}}),PJ.BootstrapTable=PJ.Table.sub({init:function(){this.view=new PJ.BootstrapTableTemplateView({target:this.tableElement,actionData:this.actionData?this.actionData:{}}),this.paginationStrategy=new PJ.PaginationBar({view:new PJ.BootstrapPaginationTemplateView({target:this.paginationElement}),pageSize:this.pageSize}),this.initialize()}}),PJ.BootstrapTableTemplateView=PJ.JQueryTemplateView.sub({tableTemplate:'<table class="table table-condensed table-striped" cellpadding="0" cellspacing="0" width="100%"><tr class="header-row"> </tr> </table>',actionsTemplate:'<div class="actions"><ul style="list-style-type: none;">{{each(idx,action) columnModel.actions}}    {{html actionFormatter(action)}}  {{/each}}</ul></div>',actionData:{},actionTemplate:'<li style="display: inline"><a href="#" class="action-link" data-action-id="${action.id}"><i class="${actionData[action.id]} icon-large" title="${action.label}"></i></a></li>',actionFormatter:function(e){var t=$("<span></span>");return $(this.wrap(this.actionTemplate)).tmpl({action:e,actionData:this.actionData}).appendTo(t),t.html()}}),PJ.BootstrapPaginationTemplateView=PJ.JQueryTemplatePaginationView.sub({paginationBarTemplate:'<div class="pagination-bar">      <div class="pagination pagination-centered">        <ul>          <li><a style="margin-left: 10px" href="#" class="pgn-prev" title="Previous Page">&laquo;</a></li>          {{each(idx,p) pages}} <li><a class="number pagination-page" href="#" data-page="${idx+1}">${idx+1}</a></li>{{/each}}          <li><a style="margin-right: 10px" href="#" class="pgn-next" title="Next Page">&raquo;</a></li>        </ul>     </div>   </div>',selectPage:function(e){this.target.find("li").removeClass("active"),this.target.find('a[data-page="'+e+'"]').parent("li").addClass("active")}});