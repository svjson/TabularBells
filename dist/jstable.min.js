/*! JSTABLE - v0.1.0 - 2013-03-05
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 YOUR_NAME; Licensed MIT */
var PJ=PJ||{};PJ.Class=function(e){var t=function(e){for(var t in e)this[t]=e[t];this.init.apply(this,arguments)};return t.prototype.init=function(){},t.fn=t.prototype,t.fn.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},t.sub=function(e){},t.sub=function(e){var t={};for(var n in this.fn)t[n]=this.fn[n];for(var n in e)t[n]=e[n];return new PJ.Class(t)},t.include=function(e){typeof e=="function"&&(e=e());for(var n in e)t.fn[n]=e[n]},e&&t.include(e),t},PJ.Events=function(){return{listeners:{},trigger:function(e,t){this.getHandlers(e).forEach(function(e){e(t)})},bind:function(e,t){this.getHandlers(e).push(t)},getHandlers:function(e){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e]}}},PJ.DataSource=new PJ.Class({initialize:function(){}}),PJ.ArrayDataSource=PJ.DataSource.sub({data:[],init:function(e){e&&(this.data=e)},size:function(){return this.data.length},get:function(e){if(e.from>this.data.length)return[];if(!e.size)return this.data;var t=e.from,n=e.from+e.size;return n>this.data.length&&(n=this.data.length),this.data.slice(t,n)}}),PJ.PaginationView=new PJ.Class({render:function(e){}}),PJ.PaginationView.include(PJ.Events),PJ.NoPaginationView=PJ.PaginationView.sub({}),PJ.JQueryTemplatePaginationView=PJ.PaginationView.sub({paginationBarTemplate:'<div>{{each(idx,p) pages}} <a class="pagination-page" href="#" data-page="${idx+1}">[${idx+1}</a>] {{/each}}</div>',target:null,render:function(e){$(this.paginationBarTemplate).tmpl({pages:new Array(e.pages)}).appendTo(this.target),this.target.find(".pagination-page").on("click",this.proxy(function(e){var t=parseInt($(e.currentTarget).attr("data-page"));this.trigger("page-requested",{pageNumber:t})}))}}),PJ.PaginationStrategy=new PJ.Class({pageSize:20,currentPage:1,view:new PJ.NoPaginationView,initialize:function(e){this.view.render({pageSize:this.pageSize,dataSetSize:e.size(),pages:Math.ceil(e.size()/this.pageSize),currentPage:1})}}),PJ.PaginationStrategy.include(PJ.Events),PJ.NoPagination=PJ.PaginationStrategy.sub({maxResults:50,getPageQuery:function(){return{from:0}}}),PJ.PaginationBar=PJ.PaginationStrategy.sub({init:function(){this.view.bind("page-requested",this.proxy(function(e){this.currentPage=e.pageNumber,this.trigger("pagination-changed")}))},getPageQuery:function(){return{from:(this.currentPage-1)*this.pageSize,size:this.pageSize}}}),PJ.BasicColumnModel=new PJ.Class({}),PJ.TableView=new PJ.Class({init:function(){console.log("init TableView")},initialize:function(e){this.render({columnModel:e,data:[]})},render:function(e){},updateRows:function(e){}}),PJ.JQueryTemplateView=PJ.TableView.sub({target:null,tableTemplate:'<table><tr class="header-row"></tr></table>',noContentRow:'<tr class="no-content-row"><td>No content</td></tr>',headerTemplate:"<th>${header}</th>",rowTemplate:'{{each(i,row) data}}<tr class="data-row">{{each(idx,col) columnModel.columns}}<td>${row[col.index]}</td>{{/each}}</tr>{{/each}}',init:function(){},render:function(e){$(this.wrap(this.tableTemplate)).tmpl().appendTo(this.target),$(this.wrap(this.headerTemplate)).tmpl(e.columnModel.columns).appendTo(this.target.find(".header-row")),e.data&&this.updateRows(e)},updateRows:function(e){e.data.length==0?$(this.wrap(this.noContentRow)).tmpl().appendTo(this.target.find("table tbody")):(this.target.find(".no-content-row").remove(),this.target.find(".data-row").remove(),$(this.wrap(this.rowTemplate)).tmpl(e).appendTo(this.target.find("table tbody")))},wrap:function(e){return"<script>"+e+"</script>"}}),PJ.Table=new PJ.Class({view:null,dataSource:null,columnModel:null,paginationStrategy:new PJ.NoPagination,init:function(){this.initializeDataSource(),this.initializeView(),this.initializePagination(),this.paginationStrategy.bind("pagination-changed",this.proxy(this.refreshTable))},refreshTable:function(){this.view.updateRows({data:this.dataSource.get(this.paginationStrategy.getPageQuery()),columnModel:this.columnModel})},initializeView:function(){if(!this.view)throw new Error("No view specified.");this.view.initialize(this.columnModel),this.refreshTable()},initializeDataSource:function(){this.dataSource||(this.dataSource=new PJ.ArrayDataSource({data:[]})),this.dataSource.initialize()},initializePagination:function(){this.paginationStrategy.initialize(this.dataSource)}});